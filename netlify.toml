[build]
  publish = "public"
  functions = "netlify/functions"
  ignore = "bash ./netlify-ignore.sh"

# Enable local backend proxy for CMS in development
[dev]
  publish = "public"
  autoLaunch = false

# PHASE 4: Scheduled function - Redirect canary (every 10 minutes)
[functions]
  # Uncomment to enable scheduled redirect monitoring
  # [[functions.canary-redirect.schedule]]
  #   cron = "*/10 * * * *"  # Every 10 minutes

# Redirect /go to click tracking function (preserves query params)
[[redirects]]
  from = "/go"
  to = "/.netlify/functions/go"
  status = 200
  force = true

# Redirect /api/* to API function
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/api"
  status = 200
  force = true

# Protect admin assets from being rewritten - MUST come before any catch-all
[[redirects]]
  from = "/admin/*"
  to = "/admin/:splat"
  status = 200

[[redirects]]
  from = "/admin"
  to = "/admin/"
  status = 301

[[headers]]
  for = "/*"
  [headers.values]
    Referrer-Policy = "strict-origin-when-cross-origin"
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "DENY"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# Immutable cache for static assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Ensure your deals JSON is always fresh for visitors/pinners
[[headers]]
  for = "/data/*"
  [headers.values]
    Cache-Control = "no-store"
